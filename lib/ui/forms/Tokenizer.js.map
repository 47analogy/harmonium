{"version":3,"sources":["../../../src/ui/forms/Tokenizer.es6"],"names":[],"mappings":"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","file":"Tokenizer.js","sourcesContent":["const KEY_TAB = 9\nconst KEY_ENTER = 13\nconst KEY_ESC = 27\n\nRev.registerComponent('Tokenizer', class Tokenizer extends React.Component {\n\n  static get propTypes() {\n    return {\n      placeholder: React.PropTypes.string,\n      remoteOptionsUrl: React.PropTypes.string,\n      queryParam: React.PropTypes.string,\n      selectedItems: React.PropTypes.array,\n      inputClassName: React.PropTypes.string,\n      optionListClassName: React.PropTypes.string,\n      optionClassName: React.PropTypes.string,\n      tokenListClassName: React.PropTypes.string,\n      tokenClassName: React.PropTypes.string,\n      removeButtonClassName: React.PropTypes.string,\n      leaveOpen: React.PropTypes.bool,\n      getItemValue: React.PropTypes.func,\n      getOptionComponent: React.PropTypes.func,\n      getTokenComponent: React.PropTypes.func,\n      getInputName: React.PropTypes.func,\n\n    }\n  }\n\n  static get defaultProps() {\n    return {\n      placeholder: '',\n      remoteOptionsUrl: null,\n      queryParam: 'q',\n      selectedItems: [],\n      inputClassName: 'RevTokenizer-input',\n      optionListClassName: 'RevTokenizer-options',\n      optionClassName: 'RevTokenizer-option',\n      tokenListClassName: 'RevTokenizer-tokens',\n      tokenClassName: 'RevTokenizer-token',\n      removeButtonClassName: 'RevTokenizer-remove',\n      leaveOpen: false,\n    }\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      ignoreKeyUp: false,\n      optionItems: [],\n      selectedItems: this.props.selectedItems,\n    }\n  }\n\n  // Default is item.id\n  getItemValue(item) {\n    return (this.props.getItemValue || ((item) => item.id))(item)\n  }\n\n  getSelectedValues() {\n    return this.state.selectedItems.map(this.getItemValue.bind(this))\n  }\n\n  // Defaults to whatever getTokenComponent returns\n  getOptionComponent(item) {\n    return (this.props.getOptionComponent || this.getTokenComponent)(item)\n  }\n\n  // Defaults to JSON\n  getTokenComponent(item) {\n    return (this.props.getTokenComponent || JSON.stringify)(item)\n  }\n\n  // Default for <Tokenizer name=\"store[widgets]\" /> is <input name=\"store[widgets][]\" />\n  getInputName(item) {\n    return (this.props.getInputName || (() => `${this.props.name}`))(item)\n  }\n\n  // List item that contains @getTokenComponent(item) and a remove button\n  renderToken(item) {\n    return (\n      <li className={this.props.tokenClassName} key={`token-${this.getItemValue(item)}`}>\n        {this.getTokenComponent(item)}\n        <input\n          type=\"hidden\"\n          name={this.getInputName(item)}\n          value={this.getItemValue(item)}\n          readOnly\n        />\n        <a\n          className={this.props.removeButtonClassName}\n          href=\"#\"\n          onClick={() => this.onRemove(item)}\n        >\n          Remove\n        </a>\n      </li>\n    )\n  }\n\n  getInput() {\n    return this.refs.input.getDOMNode()\n  }\n\n  // List item that contains @getOptionComponent(item)\n  renderOption(item) {\n    return (\n      <li\n        className={this.props.optionClassName}\n        key={`option-${this.getItemValue(item)}`}\n        onClick={() => this.onSelect(item)}\n      >\n        {this.getOptionComponent(item)}\n      </li>\n    )\n  }\n\n  // Renders a list only if it has items\n  renderTokens() {\n    if(!this.state.selectedItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.tokenListClassName}>\n        {this.state.selectedItems.map(this.renderToken.bind(this))}\n      </ul>\n    )\n  }\n\n  // Renders a list only if it has items\n  renderOptions() {\n    if(!this.state.optionItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.optionListClassName}>\n        {this.state.optionItems.map(this.renderOption.bind(this))}\n      </ul>\n    )\n  }\n\n  render() {\n    return (\n      <div>\n        {this.renderTokens()}\n        <div className={this.props.className}>\n          <input\n            ref=\"input\"\n            type={this.props.type || 'text'}\n            className={this.props.inputClassName}\n            placeholder={this.props.placeholder}\n            defaultValue={this.props.defaultValue}\n            onKeyDown={this.onKeyDown.bind(this)}\n            onKeyUp={this.onKeyUp.bind(this)}\n            onBlur={this.onBlur.bind(this)}\n            onFocus={this.onFocus.bind(this)} />\n          {this.props.children}\n        </div>\n        {this.renderOptions()}\n      </div>\n    )\n  }\n\n  isSelectKey(e) {\n    return e.keyCode == KEY_TAB || e.keyCode == KEY_ENTER\n  }\n\n  onKeyDown(e) {\n    // prevent blur, form submit, etc.\n    // unless there's no text in the box, in which case we don't worry about it\n    return this.state.optionItems.length == 0 || !this.isSelectKey(e)\n  }\n\n  onKeyUp(e) {\n    if(this.isSelectKey(e)) {\n      // Select the first item on special keypresses\n      if(this.state.optionItems.length > 0) {\n        this.onSelect(this.state.optionItems[0])\n      }\n    }\n    else if(e.keyCode == KEY_ESC) {\n      // Esc to make the option go away\n      this.getInput().blur()\n    }\n    else {\n      this.fetchOptions()\n    }\n\n    this.setState({\n      ignoreKeyUp: false,\n    })\n  }\n\n  onBlur() {\n    if(this.props.leaveOpen) {\n      return\n    }\n    // If you don't delay this a little you can't click any of the options\n    clearOptions = () => this.setState({optionItems: []})\n    setTimeout(clearOptions, 200)\n  }\n\n  onFocus() {\n    this.fetchOptions()\n  }\n\n  clearOptions() {\n    if(this.xhr != null) {\n      this.xhr.abort()\n    }\n    this.setState({optionItems: []})\n  }\n\n  setOptions(items) {\n    rejectItem = (item) => _.contains(this.getSelectedValues(), this.getItemValue(item))\n    this.setState({\n      optionItems: _.reject(items, rejectItem),\n    })\n  }\n\n  fetchOptions() {\n    if(this.getInput().value == '') {\n      this.clearOptions()\n    }\n    else {\n      let queryData = {}\n      queryData[this.props.queryParam] = this.getInput().value\n      this.xhr = $.get(this.props.remoteOptionsUrl, queryData)\n      this.xhr.done(this.setOptions.bind(this))\n    }\n  }\n\n  onSelect(item) {\n    let items = this.state.selectedItems\n    items.push(item)\n    items = _.uniq(items, null, this.getItemValue.bind(this))\n    input = this.getInput()\n    input.value = ''\n    input.focus()\n    this.clearOptions()\n    this.setState({selectedItems: items})\n    return false\n  }\n\n  onRemove(item) {\n    const items = _.reject(this.state.selectedItems, (x) => this.getItemValue(x) == this.getItemValue(item))\n    this.setState({selectedItems: items})\n    return false\n  }\n})\n"]}